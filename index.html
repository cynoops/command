<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://api.mapbox.com; img-src 'self' data: blob: https://api.mapbox.com https://*.tiles.mapbox.com https://maps.gstatic.com https://maps.gstatic.com/*; font-src 'self' data: https://api.mapbox.com; script-src 'self'; connect-src 'self' data: blob: https://api.mapbox.com https://*.tiles.mapbox.com https://events.mapbox.com https://maps.googleapis.com https://places.googleapis.com https://geocoding.googleapis.com https://weather.googleapis.com https://firestore.googleapis.com https://identitytoolkit.googleapis.com; worker-src 'self' blob:;"
  />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Command - CYNOOPS</title>

  <!-- Your main app styles -->
  <link rel="stylesheet" href="./styles.css" />
  <link rel="stylesheet" href="./scale-dialog.css" />

  <!-- Mapbox GL CSS (bundled locally into dist/vendor) -->
  <link rel="stylesheet" href="./dist/vendor/mapbox-gl/mapbox-gl.css" />
</head>
<body>
  <div class="app">

    <!-- Header -->
    <header class="app-header">
      <div class="app-toolbar" role="toolbar" aria-label="Map tools">
        <div class="tool-group tool-group--nav" data-label="NAV">
          <!-- View controls -->
          <button id="toolZoomIn" class="tool-btn" data-tooltip="Zoom in">
            <img class="icon" src="./assets/icons/regular/plus.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolZoomOut" class="tool-btn" data-tooltip="Zoom out">
            <img class="icon" src="./assets/icons/regular/minus.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolResetView" class="tool-btn" data-tooltip="Reset bearing & pitch">
            <img class="icon" src="./assets/icons/regular/compass.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolPin" class="tool-btn" aria-pressed="false" data-tooltip="Pin/unpin map">
            <img class="icon" src="./assets/icons/regular/lock.svg" alt="" aria-hidden="true" />
          </button>
        </div>
        <div class="tool-group tool-group--draw" data-label="DRAW">
          <button id="toolEdit" class="tool-btn" aria-pressed="false" data-tooltip="Edit features">
            <img class="icon" src="./assets/icons/regular/arrows-out-cardinal.svg" alt="" aria-hidden="true" />
          </button>
          <span class="tool-spacer" aria-hidden="true"></span>
          <button id="toolRect" class="tool-btn" aria-pressed="false" data-tooltip="Draw rectangle">
            <img class="icon" src="./assets/icons/regular/bounding-box.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolPoly" class="tool-btn" aria-pressed="false" data-tooltip="Draw polygon">
            <img class="icon" src="./assets/icons/regular/polygon.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolCircle" class="tool-btn" aria-pressed="false" data-tooltip="Draw circle">
            <img class="icon" src="./assets/icons/regular/circle.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolLine" class="tool-btn" aria-pressed="false" data-tooltip="Draw polyline">
            <img class="icon" src="./assets/icons/regular/line-segments.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolArrow" class="tool-btn" aria-pressed="false" data-tooltip="Draw arrow">
            <img class="icon" src="./assets/icons/regular/arrow-fat-line-right.svg" alt="" aria-hidden="true" />
          </button>
          <!-- POI button sits next to Line -->
          <button id="toolPOI" class="tool-btn" aria-pressed="false" data-tooltip="Add POI">
            <img class="icon" src="./assets/icons/regular/map-pin-plus.svg" alt="" aria-hidden="true" />
          </button>
        </div>
        <div class="tool-group tool-group--utility" data-label="UTILITY">
          <button id="toolSearch" class="tool-btn" aria-pressed="false" data-tooltip="Search address">
            <img class="icon" src="./assets/icons/regular/magnifying-glass.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolGoTo" class="tool-btn" aria-pressed="false" data-tooltip="Go to coordinates">
            <img class="icon" src="./assets/icons/regular/map-pin-line.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolCrosshair" class="tool-btn" aria-pressed="false" data-tooltip="Show coordinates">
            <img class="icon" src="./assets/icons/regular/crosshair.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolSetScale" class="tool-btn" aria-pressed="false" data-tooltip="Set scale">
            <img class="icon" src="./assets/icons/regular/ruler.svg" alt="" aria-hidden="true" />
          </button>
        </div>
        <div class="tool-group tool-group--overlays" data-label="OVERLAYS">
          <label class="visually-hidden" for="overlaySelect" data-i18n="map.overlays.label">Overlays</label>
          <div class="tool-select-wrap">
            <img class="tool-select-icon" src="./assets/icons/regular/grid-nine.svg" alt="" aria-hidden="true" />
            <select id="overlaySelect" class="tool-select" aria-label="Overlays" data-i18n-aria-label="map.overlays.label">
              <option value="none" data-i18n="map.overlays.none">None</option>
              <option value="utm" data-i18n="map.overlays.utm">UTM Grid</option>
              <option value="gcs" data-i18n="map.overlays.gcs">GCS Grid</option>
            </select>
            <img class="tool-select-caret" src="./assets/icons/regular/caret-down.svg" alt="" aria-hidden="true" />
          </div>
        </div>
        <div class="tool-group tool-group--export" data-label="EXPORT">
          <button id="toolPrint" class="tool-btn" aria-pressed="false" data-tooltip="Save snapshot">
            <img class="icon" src="./assets/icons/regular/file-image.svg" alt="" aria-hidden="true" />
          </button>
          <button id="toolExportPdf" class="tool-btn" aria-pressed="false" data-tooltip="Export PDF">
            <img class="icon" src="./assets/icons/regular/file-pdf.svg" alt="" aria-hidden="true" />
          </button>
        </div>
      </div>

      <dialog id="scaleDialog" class="scale-dialog" aria-labelledby="scaleDialogTitle">
        <form method="dialog" class="scale-dialog__content">
          <header class="scale-dialog__header">
            <h2 id="scaleDialogTitle">Set map scale</h2>
            <button type="button" class="scale-dialog__close" data-action="close" aria-label="Close">
              <img class="icon" src="./assets/icons/regular/x.svg" alt="" aria-hidden="true" />
            </button>
          </header>
          <div class="scale-dialog__grid">
            <button type="button" class="scale-option" data-scale="2500">1:2,500</button>
            <button type="button" class="scale-option" data-scale="5000">1:5,000</button>
            <button type="button" class="scale-option" data-scale="10000">1:10,000</button>
            <button type="button" class="scale-option" data-scale="15000">1:15,000</button>
            <button type="button" class="scale-option" data-scale="20000">1:20,000</button>
            <button type="button" class="scale-option" data-scale="25000">1:25,000</button>
            <button type="button" class="scale-option" data-scale="50000">1:50,000</button>
          </div>
          <div class="scale-dialog__actions">
            <button type="submit" class="btn-secondary" value="cancel">Close</button>
          </div>
        </form>
      </dialog>

      <div class="actions">
        <button id="settingsQuickBtn" class="btn-icon action-icon" type="button" title="Settings" aria-label="Settings" data-tooltip="Settings" data-i18n-title="nav.settings" data-i18n-aria-label="nav.settings">
          <img class="icon" src="./assets/icons/regular/gear.svg" alt="" aria-hidden="true" />
        </button>
        <div class="lang-dropdown" id="languageDropdown">
          <button class="btn-icon" id="languageToggle" type="button" aria-haspopup="true" aria-expanded="false" title="Change language" aria-label="Change language" data-tooltip="Change language">
            <img class="icon" src="./assets/icons/regular/globe.svg" alt="" aria-hidden="true" />
          </button>
          <div class="lang-menu" id="languageMenu" role="menu" hidden>
          <button class="lang-menu-item" type="button" role="menuitem" data-lang="en">English</button>
          <button class="lang-menu-item" type="button" role="menuitem" data-lang="de">Deutsch</button>
          <button class="lang-menu-item" type="button" role="menuitem" data-lang="fr">Français</button>
          <button class="lang-menu-item" type="button" role="menuitem" data-lang="es">Español</button>
          <button class="lang-menu-item" type="button" role="menuitem" data-lang="it">Italiano</button>
          </div>
        </div>
        <button id="toolShortcuts" class="btn-icon action-icon" title="Keyboard shortcuts" aria-label="Keyboard shortcuts" data-tooltip="Keyboard shortcuts">
          <img class="icon" src="./assets/icons/regular/keyboard.svg" alt="" aria-hidden="true" />
        </button>
        <button id="fullscreenBtn" class="btn-icon action-icon" title="Toggle full screen" aria-label="Toggle full screen" data-tooltip="Toggle full screen">
          <img class="icon" src="./assets/icons/regular/corners-out.svg" alt="" aria-hidden="true" />
        </button>
      </div>
    </header>

    <!-- Tabs (CSS-only) moved out of header so CSS sibling selectors work -->
    <input id="tab-map" type="radio" name="main-tabs" class="tab-input" checked />
    <input id="tab-settings" type="radio" name="main-tabs" class="tab-input" />



    <!-- Main content -->
    <main class="app-main">
      <!-- MAP VIEW -->
      <section id="view-map" class="view view-map" role="tabpanel" aria-labelledby="tab-map">
        <div id="mapWelcome" class="map-welcome" hidden>
          <div class="map-welcome-card" role="dialog" aria-labelledby="mapWelcomeTitle" aria-describedby="mapWelcomeDesc">
            <h2 id="mapWelcomeTitle">Welcome to CynoOps Command</h2>
            <p id="mapWelcomeDesc">To start exploring the map, add your Mapbox access token under <strong>Settings → API Keys</strong>. Once saved, the map will load automatically.</p>
            <ul class="map-welcome-todo">
              <li>Sign in at <a href="https://account.mapbox.com" target="_blank" rel="noopener">mapbox.com</a> and copy a public access token.</li>
              <li>Open the Settings tab and paste the token into the Mapbox Access Token field.</li>
              <li>Press <em>Save Settings</em> to initialize the map.</li>
            </ul>
            <div class="map-welcome-actions">
              <button id="mapWelcomeSettings" class="btn btn-primary" type="button">Open Settings</button>
            </div>
          </div>
        </div>
        <div id="map" class="map-container" aria-label="Interactive map">
          <div id="mapWindOverlay" class="map-wind-overlay" aria-hidden="true" hidden></div>
          <div id="mapRainOverlay" class="map-rain-overlay" aria-hidden="true" hidden></div>
          <!-- Crosshair overlay (placed inside container so it's always centered) -->
          <div id="mapCrosshair" class="map-crosshair" aria-hidden="false"></div>
        </div>
        <div class="map-overlay-menus" aria-label="Map overlays">
          <div class="map-overlay-combined">
            <div id="mapUtilityToolbar" class="map-utility-toolbar map-utility-toolbar--inline" aria-label="Map utilities">
              <button class="map-utility-btn is-active" type="button" data-tool="features" aria-pressed="true" data-tooltip="Features">
                <img src="./assets/icons/regular/polygon.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle features</span>
              </button>
              <button class="map-utility-btn" type="button" aria-pressed="false" data-tool="cloud-sun" data-tooltip="Weather">
                <img src="./assets/icons/regular/cloud-sun.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle weather overlay</span>
              </button>
              <button class="map-utility-btn is-active" type="button" data-tool="trackers" aria-pressed="true" data-tooltip="Teams">
                <img src="./assets/icons/regular/air-traffic-control.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle teams</span>
              </button>
            </div>
            <div class="map-overlay-separator" aria-hidden="true"></div>
            <div id="mapSessionOverlay" class="map-session-overlay map-session-overlay--inline" aria-live="polite">
              <div class="map-session-info">
                <div id="mapSessionEmpty" class="map-session-empty" data-i18n="teams.noActiveSession">No active session</div>
                <div id="mapSessionActive" class="map-session-active" hidden>
                  <button id="mapSessionTitle" class="map-session-title map-session-title-button" type="button" aria-haspopup="dialog" aria-controls="teamsSessionActionsModal"></button>
                  <div id="mapSessionId" class="map-session-id" data-i18n-aria-label="sessionOverlay.idAria" aria-label="Session ID">—</div>
                </div>
              </div>
              <div class="map-session-actions">
                <button id="mapSessionStartBtn" class="btn btn-primary map-session-action" type="button" data-i18n="sessionOverlay.startNew">New</button>
                <button id="mapSessionResumeBtn" class="btn map-session-action" type="button" data-i18n="sessionOverlay.resume">Load</button>
              </div>
            </div>
            <div class="map-overlay-separator" aria-hidden="true"></div>
            <div id="mapStyleToolbar" class="map-utility-toolbar map-style-toolbar map-utility-toolbar--inline" aria-label="Map styles">
              <button class="map-utility-btn" type="button" aria-pressed="false" data-tool="street" data-tooltip="Street">
                <img src="./assets/icons/regular/road-horizon.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle street map style</span>
              </button>
              <button class="map-utility-btn" type="button" aria-pressed="false" data-tool="terrain" data-tooltip="Terrain">
                <img src="./assets/icons/regular/mountains.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle terrain map style</span>
              </button>
              <button class="map-utility-btn" type="button" aria-pressed="false" data-tool="satellite" data-tooltip="Satellite">
                <img src="./assets/icons/regular/map-trifold.svg" alt="" class="icon" aria-hidden="true" />
                <span class="visually-hidden">Toggle satellite map style</span>
              </button>
            </div>
          </div>
        </div>
        <div class="map-bottom-center">
          <div id="mapWindIndicator" class="map-wind-indicator" aria-live="polite" aria-hidden="true" hidden>
            <img class="map-wind-indicator__arrow" src="./assets/icons/regular/arrow-up.svg" alt="" aria-hidden="true" />
            <span class="map-wind-indicator__label">Wind</span>
          </div>
          <div class="map-label-scale" aria-label="Label size controls">
            <button id="toolLabelIncrease" class="tool-btn" aria-pressed="false" data-tooltip="Increase label & symbol size">
              <img class="icon" src="./assets/icons/regular/plus.svg" alt="" aria-hidden="true" />
            </button>
            <button id="toolLabelDecrease" class="tool-btn" aria-pressed="false" data-tooltip="Decrease label & symbol size">
              <img class="icon" src="./assets/icons/regular/minus.svg" alt="" aria-hidden="true" />
            </button>
          </div>
        </div>
        <!-- Location inputs panel removed -->
        <!-- Sidebar: Features -->
        <aside id="featuresSidebar" class="features-sidebar" aria-label="Features panel" hidden>
          <div class="features-header">
            <span class="features-title">Features</span>
            <div class="features-header-actions">
              <button id="featuresLabelsToggle" class="btn-icon" type="button" title="Toggle feature labels" aria-label="Toggle feature labels" aria-pressed="false">
                <img src="./assets/icons/regular/exam.svg" alt="" class="icon" aria-hidden="true" />
              </button>
              <button id="featuresCollapse" class="btn-icon" title="Hide sidebar" aria-label="Hide sidebar">⟨</button>
            </div>
          </div>
          <div id="drawingsList" class="features-list" aria-live="polite"></div>
          <div id="featuresActions" class="features-actions">
            <button id="featuresActionsToggle" class="features-actions-trigger" type="button" aria-haspopup="true" aria-expanded="false">
              <img src="./assets/icons/regular/dots-three-circle-vertical.svg" alt="" class="icon" aria-hidden="true" />
              <span class="visually-hidden">Open features menu</span>
            </button>
            <div id="featuresActionsMenu" class="features-actions-menu" role="menu" hidden>
              <button id="featuresSaveBtn" class="features-menu-btn" type="button" role="menuitem">
                <img src="./assets/icons/regular/file-text.svg" alt="" class="icon" aria-hidden="true" />
                <span>Save</span>
              </button>
              <button id="featuresLoadBtn" class="features-menu-btn" type="button" role="menuitem">
                <img src="./assets/icons/regular/folder-open.svg" alt="" class="icon" aria-hidden="true" />
                <span>Load</span>
              </button>
              <button id="featuresLoadGpxBtn" class="features-menu-btn" type="button" role="menuitem">
                <img src="./assets/icons/regular/path.svg" alt="" class="icon" aria-hidden="true" />
                <span>Load from GPX</span>
              </button>
              <button id="featuresClearBtn" class="features-menu-btn" type="button" role="menuitem">
                <img src="./assets/icons/regular/broom.svg" alt="" class="icon" aria-hidden="true" />
                <span>Clear</span>
              </button>
            </div>
          </div>
          <div id="featuresResizer" class="features-resizer" title="Drag to resize" aria-hidden="true"></div>
        </aside>
        <button id="featuresToggleBtn" class="sidebar-toggle sidebar-toggle-left" type="button" aria-controls="featuresSidebar" aria-expanded="false">
          <img src="./assets/icons/regular/caret-right.svg" alt="" class="icon icon-chevron" aria-hidden="true" />
          <span class="sidebar-toggle-label">FEATURES</span>
          <img src="./assets/icons/regular/polygon.svg" alt="" class="icon" aria-hidden="true" />
          <span class="visually-hidden">Show features panel</span>
        </button>
        <aside id="trackersSidebar" class="trackers-sidebar" aria-label="Teams panel" hidden>
          <div class="trackers-header">
            <span class="trackers-title">Teams</span>
            <div class="trackers-header-actions">
              <button id="trackersCollapse" class="btn-icon" title="Hide teams panel" aria-label="Hide teams panel">⟩</button>
            </div>
          </div>
          <div id="trackersList" class="trackers-list" aria-live="polite">
            <button id="teamsAddBtn" class="btn btn-primary btn-compact" type="button" data-i18n="teams.addMember" hidden>Add member</button>
            <div id="trackersItems" class="trackers-items"></div>
          </div>
        </aside>
        <button id="trackersToggleBtn" class="sidebar-toggle sidebar-toggle-right" type="button" aria-controls="trackersSidebar" aria-expanded="false">
          <img src="./assets/icons/regular/caret-left.svg" alt="" class="icon icon-chevron" aria-hidden="true" />
          <span class="sidebar-toggle-label">TEAMS</span>
          <img src="./assets/icons/regular/air-traffic-control.svg" alt="" class="icon" aria-hidden="true" />
          <span class="visually-hidden">Show teams panel</span>
        </button>
        <!-- You’ll initialize the map in your preload/renderer JS and update footer stats by ID -->
      </section>

      <!-- SETTINGS VIEW -->
      <section id="view-settings" class="view view-settings" role="tabpanel" aria-labelledby="tab-settings">
        <div class="panel settings-panel">
          <div class="settings-header">
            <h2 data-i18n="settings.title">Settings</h2>
          </div>
          <div class="settings-layout">
            <aside class="settings-sidebar" aria-label="Categories" data-i18n-aria-label="settings.groupsTitle">
              <span class="settings-nav-title" data-i18n="settings.groupsTitle">Categories</span>
              <div class="settings-nav">
                <button id="settings-group-btn-general" class="settings-nav-item is-active" type="button" data-settings-group="general" aria-pressed="true" aria-controls="settings-group-general" data-i18n="settings.section.general">General</button>
                <button id="settings-group-btn-api" class="settings-nav-item" type="button" data-settings-group="api-keys" aria-pressed="false" aria-controls="settings-group-api-keys" data-i18n="settings.section.apiKeys">API Keys</button>
                <button id="settings-group-btn-firebase" class="settings-nav-item" type="button" data-settings-group="firebase" aria-pressed="false" aria-controls="settings-group-firebase" data-i18n="settings.section.firebase">Firebase</button>
                <button id="settings-group-btn-map" class="settings-nav-item" type="button" data-settings-group="map" aria-pressed="false" aria-controls="settings-group-map" data-i18n="settings.section.map">Map Settings</button>
              </div>
            </aside>
            <div class="settings-content">
              <form id="settingsForm" class="settings-form">
                <div class="settings-group is-active" data-settings-group="general" id="settings-group-general" role="region" aria-labelledby="settings-group-general-title">
                  <h3 id="settings-group-general-title" data-i18n="settings.section.general">General</h3>
                  <div class="settings-fields">
                    <label class="field">
                      <span class="label">App Language</span>
                      <select id="settingLanguage" autocomplete="off">
                        <option value="en">English</option>
                        <option value="de">German</option>
                        <option value="fr">French</option>
                        <option value="es">Spanish</option>
                        <option value="it">Italian</option>
                      </select>
                    </label>
                  </div>
                </div>

                <div class="settings-group" data-settings-group="api-keys" id="settings-group-api-keys" role="region" aria-labelledby="settings-group-api-keys-title" hidden>
                  <h3 id="settings-group-api-keys-title" data-i18n="settings.section.apiKeys">API Keys</h3>
                  <div class="settings-fields">
                    <label class="field">
                      <span class="label label-with-help">Mapbox Access Token
                        <button type="button" class="label-help" aria-label="Where to find your Mapbox access token" data-tooltip="Sign in at mapbox.com, open your account dashboard, and copy a public access token.">info</button>
                      </span>
                      <input id="settingAccessToken" type="password" autocomplete="off" placeholder="pk.•••" />
                    </label>
                    <label class="field">
                      <span class="label label-with-help">Google Maps API Key
                        <button type="button" class="label-help" aria-label="How to get a Google Maps API key" data-tooltip="Use the Google Cloud Console to create a project, enable Maps JavaScript & Places APIs, then create an API key under Credentials.">info</button>
                      </span>
                      <input id="settingGoogleKey" type="password" autocomplete="off" placeholder="AIza•••" />
                    </label>
                    <label class="field">
                      <span class="label label-with-help">OpenAI API Key
                        <button type="button" class="label-help" aria-label="How to get an OpenAI API key" data-tooltip="Go to platform.openai.com/account/api-keys, create a new secret key, and paste it here.">info</button>
                      </span>
                      <input id="settingOpenAIKey" type="password" autocomplete="off" placeholder="sk-•••" />
                    </label>
                  </div>
                </div>

                <div class="settings-group" data-settings-group="firebase" id="settings-group-firebase" role="region" aria-labelledby="settings-group-firebase-title" hidden>
                  <h3 id="settings-group-firebase-title" data-i18n="settings.section.firebase">Firebase</h3>
                  <div class="settings-fields">
                    <label class="field firebase-panel firebase-admin-credentials">
                      <div class="firebase-admin-header">
                        <div class="firebase-admin-title">
                          <span id="firebaseAdminLabelText" data-i18n="settings.firebaseAdminCredentials">Firebase Admin Credentials (JSON)</span>
                          <span class="firebase-admin-badge">Service account</span>
                        </div>
                      </div>
                      <div class="firebase-admin-body">
                        <div class="firebase-admin-row">
                          <button id="firebaseAdminSelectBtn" class="btn" type="button" data-i18n="settings.firebaseAdminSelect">Select JSON</button>
                          <button id="firebaseAdminClearBtn" class="btn" type="button" data-i18n="settings.firebaseAdminClear" hidden>Remove</button>
                        </div>
                        <input id="firebaseAdminFileInput" type="file" accept="application/json,.json" hidden />
                        <div class="firebase-admin-row firebase-admin-meta-row">
                          <div class="firebase-admin-meta">
                            <span id="firebaseAdminStatus" class="firebase-admin-status" data-i18n="settings.firebaseAdminStatus.empty">No Firebase Admin credentials loaded.</span>
                            <span id="firebaseAdminProject" class="firebase-admin-project" hidden></span>
                          </div>
                        </div>
                      </div>
                    </label>
                    <div class="firebase-admin-actions firebase-panel">
                      <div class="firebase-admin-actions-title" data-i18n="settings.firebaseAdminActionsTitle">Firebase Admin Actions</div>
                      <div class="firebase-admin-actions-hint muted" data-i18n="settings.firebaseAdminActionsHint">These actions modify Firestore data for all sessions.</div>
                      <div class="firebase-admin-actions-row">
                        <button id="firebaseDeployAllBtn" class="btn btn-primary" type="button" data-i18n="settings.firebaseDeployAll">Deploy all Firebase</button>
                      </div>
                      <div class="firebase-admin-actions-row firebase-admin-actions-danger">
                        <button id="firebaseAdminClearSessionsBtn" class="btn btn-danger" type="button" data-i18n="settings.firebaseAdminClearSessions">Clear all sessions</button>
                        <button id="firebaseAdminClearAnonymousUsersBtn" class="btn btn-danger" type="button" data-i18n="settings.firebaseAdminClearAnonymousUsers">Clear anonymous users</button>
                      </div>
                      <div id="firebaseAdminActionsStatus" class="firebase-admin-actions-status muted" data-i18n="settings.firebaseAdminActionsStatus.needsAdmin">Requires Firebase Admin credentials.</div>
                    </div>
                    <div class="firebase-rules firebase-panel">
                      <div class="firebase-panel-header">
                        <div>
                          <div class="firebase-rules-title" data-i18n="settings.firebaseRulesTitle">Firebase Rules</div>
                          <div class="firebase-rules-hint muted" data-i18n="settings.firebaseRulesHint">Edit and deploy Firestore rules.</div>
                        </div>
                        <div id="firebaseFirestoreRulesStatus" class="firebase-rules-status muted" role="status" aria-live="polite"></div>
                      </div>
                      <div class="field rules-editor" id="firestoreRulesEditor">
                        <div class="rules-editor-header">
                          <span id="firestoreRulesLabel" class="label" data-i18n="settings.firebaseFirestoreRules">firestore.rules</span>
                          <button id="firebaseCollapseFirestoreRulesBtn" class="btn btn-tertiary btn-small rules-toggle-btn" type="button" aria-label="Collapse editor" data-i18n-aria-label="settings.firebaseRulesCollapseLabel">▴</button>
                        </div>
                        <div class="rules-editor-row">
                          <textarea id="settingFirestoreRules" class="rules-editor-input" spellcheck="false" aria-labelledby="firestoreRulesLabel"></textarea>
                          <div class="rules-editor-actions">
                            <button id="firebaseDeployFirestoreRulesBtn" class="btn btn-primary btn-small" type="button" data-i18n="settings.firebaseRulesDeploy">Deploy</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="firebase-rules firebase-storage firebase-panel">
                      <div class="firebase-panel-header">
                        <div>
                          <div class="firebase-rules-title" data-i18n="settings.firebaseStorageRulesTitle">Storage Rules</div>
                          <div class="firebase-rules-hint muted" data-i18n="settings.firebaseStorageRulesHint">Edit and deploy Storage rules.</div>
                        </div>
                        <div id="firebaseStorageRulesStatus" class="firebase-rules-status muted" role="status" aria-live="polite"></div>
                      </div>
                      <div class="field rules-editor" id="storageRulesEditor">
                        <div class="rules-editor-header">
                          <span id="storageRulesLabel" class="label" data-i18n="settings.firebaseStorageRules">storage.rules</span>
                          <button id="firebaseCollapseStorageRulesBtn" class="btn btn-tertiary btn-small rules-toggle-btn" type="button" aria-label="Collapse editor" data-i18n-aria-label="settings.firebaseRulesCollapseLabel">▴</button>
                        </div>
                        <div class="rules-editor-row">
                          <textarea id="settingStorageRules" class="rules-editor-input" spellcheck="false" aria-labelledby="storageRulesLabel"></textarea>
                          <div class="rules-editor-actions">
                            <button id="firebaseDeployStorageRulesBtn" class="btn btn-primary btn-small" type="button" data-i18n="settings.firebaseRulesDeploy">Deploy</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="firebase-functions firebase-panel">
                      <div class="firebase-panel-header">
                        <div>
                          <div class="firebase-functions-title" data-i18n="settings.firebaseFunctionsTitle">Firebase Functions</div>
                          <div class="firebase-functions-hint muted" data-i18n="settings.firebaseFunctionsHint">Edit and deploy the tracker updates function.</div>
                        </div>
                        <div id="firebaseFunctionsStatus" class="firebase-rules-status muted" role="status" aria-live="polite"></div>
                      </div>
                      <div class="field rules-editor" id="functionsRulesEditor">
                        <div class="rules-editor-header">
                          <span id="functionsRulesLabel" class="label" data-i18n="settings.firebaseFunctionsIndexLabel">functions/index.js</span>
                          <button id="firebaseCollapseFunctionsBtn" class="btn btn-tertiary btn-small rules-toggle-btn" type="button" aria-label="Collapse editor" data-i18n-aria-label="settings.firebaseRulesCollapseLabel">▴</button>
                        </div>
                        <div class="rules-editor-row">
                          <textarea id="settingFirebaseFunctionIndex" class="rules-editor-input" spellcheck="false" aria-labelledby="functionsRulesLabel"></textarea>
                          <div class="rules-editor-actions">
                            <button id="firebaseDeployFunctionsBtn" class="btn btn-primary btn-small" type="button" data-i18n="settings.firebaseRulesDeploy">Deploy</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="firebase-config firebase-panel">
                      <div class="firebase-panel-header">
                        <div>
                          <div id="firebaseConfigLabel" class="firebase-rules-title" data-i18n="settings.firebaseConfig">Firebase Settings (JSON)</div>
                          <div class="firebase-rules-hint muted" data-i18n="settings.firebaseConfigHint">Auto-generated from Admin credentials; stored locally (read-only).</div>
                        </div>
                        <button id="firebaseCollapseConfigBtn" class="btn btn-tertiary btn-small rules-toggle-btn" type="button" aria-label="Collapse editor" data-i18n-aria-label="settings.firebaseRulesCollapseLabel">▴</button>
                      </div>
                      <div class="field rules-editor" id="firebaseConfigEditor">
                        <div class="rules-editor-row">
                          <textarea id="settingFirebaseConfig" class="rules-editor-input" aria-labelledby="firebaseConfigLabel" placeholder='{"apiKey":"...","authDomain":"...","projectId":"..."}' readonly aria-readonly="true"></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="settings-group" data-settings-group="map" id="settings-group-map" role="region" aria-labelledby="settings-group-map-title" hidden>
                  <h3 id="settings-group-map-title" data-i18n="settings.section.map">Map Settings</h3>
                  <div class="settings-fields">
                    <label class="field">
                      <span class="label" data-i18n="settings.streetStyleUrl">Street Map Style URL</span>
                      <input id="settingStyleUrl" type="text" placeholder="mapbox://styles/your-style-id" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.satelliteStyleUrl">Satellite Map Style URL</span>
                      <input id="settingSatelliteStyleUrl" type="text" placeholder="mapbox://styles/mapbox/standard-satellite" value="mapbox://styles/mapbox/standard-satellite" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.terrainStyleUrl">Terrain Map Style URL</span>
                      <input id="settingTerrainStyleUrl" type="text" placeholder="mapbox://styles/mapbox/outdoors-v12" value="mapbox://styles/mapbox/outdoors-v12" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.homeAddress">Home Address</span>
                      <input id="settingHomeAddress" type="text" placeholder="e.g., 1600 Amphitheatre Parkway, Mountain View, CA" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.startLatitude">Start Latitude</span>
                      <input id="settingStartLat" type="number" step="0.000001" min="-90" max="90" placeholder="49.610000" value="49.610000" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.startLongitude">Start Longitude</span>
                      <input id="settingStartLng" type="number" step="0.000001" min="-180" max="180" placeholder="6.130000" value="6.130000" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.startZoom">Start Zoom</span>
                      <input id="settingStartZoom" type="number" min="0" max="22" step="0.1" value="12" />
                    </label>
                    <label class="field">
                      <span class="label" data-i18n="settings.coordinateSystem">Coordinate System</span>
                      <select id="settingCoordinateSystem">
                        <option value="latlng" data-i18n="settings.coord.latlng">Lat/Long</option>
                        <option value="utm" data-i18n="settings.coord.utm">UTM</option>
                        <option value="gk" data-i18n="settings.coord.gk">GK</option>
                      </select>
                    </label>
                  </div>
                </div>

              </form>
            </div>
          </div>
        </div>
        <div class="settings-footer">
          <div class="settings-actions">
            <span class="settings-status" aria-live="polite"></span>
            <button id="settingsCloseBtn" class="btn" type="button" data-i18n="settings.close">Close Settings</button>
            <button id="settingsSaveBtn" class="btn btn-primary" type="submit" form="settingsForm" disabled>Save Settings</button>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer: map & data stats -->
    <footer class="app-footer" aria-live="polite">
      <div class="stat"><span class="k">Lat/Long</span><span id="statCenter" class="v">—</span></div>
      <div class="stat"><span class="k">Zoom</span><span id="statZoom" class="v">—</span></div>
      <div class="stat"><span class="k">Scale</span><span id="statScale" class="v">—</span></div>
      <div class="stat"><span class="k">Bearing</span><span id="statBearing" class="v">—</span></div>
      <div class="stat"><span class="k">Pitch</span><span id="statPitch" class="v">—</span></div>
      <div class="stat" style="justify-self:end; text-align:right;">
        <span class="k">Address</span>
        <span id="footerAddress" class="v">—</span>
      </div>
    </footer>
    <div id="toastContainer" class="toast-container" aria-live="polite"></div>
  </div>

  <!-- Coordinates Modal -->
  <div id="coordModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="coordTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(800px, 96vw);">
      <div class="modal-header">
        <h3 id="coordTitle" data-i18n="coordModal.title">Coordinates</h3>
        <button id="coordClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="coordList" class="coord-list"></div>
      </div>
      <div class="modal-footer coord-footer">
        <label class="coord-target">
          <span class="visually-hidden" data-i18n="coordModal.targetLabel">Choose map provider</span>
          <select id="coordProvider" data-i18n-placeholder="coordModal.targetLabel">
            <option value="google-maps" data-i18n="coordModal.openGoogleMaps">Google Maps</option>
            <option value="openstreetmap" data-i18n="coordModal.openOSM">OpenStreetMap</option>
            <option value="bing" data-i18n="coordModal.openBing">Bing Maps</option>
            <option value="arcgis" data-i18n="coordModal.openArcgis">ArcGIS Maps</option>
          </select>
        </label>
        <button id="coordOpenProvider" class="btn coord-open-btn" type="button" data-i18n="coordModal.openInBrowser">Open in browser</button>
      </div>
    </div>
  </div>

  <!-- Search Modal -->
  <div id="searchModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="searchTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="searchTitle">Search Address</h3>
        <button id="searchClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <label class="field">
          <span class="label">Address</span>
          <input id="searchQuery" type="text" placeholder="Type an address" autocomplete="off" />
        </label>
        <div id="searchResults" class="search-results" role="listbox" aria-label="Search results"></div>
      </div>
    </div>
  </div>

  <!-- Go To Coordinates Modal -->
  <div id="gotoModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="gotoTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="gotoTitle">Go to coordinates</h3>
        <button id="gotoClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="gotoFieldsLatLng" class="goto-fields">
          <label class="field">
            <span class="label" data-i18n="gotoModal.latitude">Latitude</span>
            <input id="gotoLat" type="number" step="0.000001" min="-90" max="90" placeholder="e.g., 49.6100" />
          </label>
          <label class="field">
            <span class="label" data-i18n="gotoModal.longitude">Longitude</span>
            <input id="gotoLng" type="number" step="0.000001" min="-180" max="180" placeholder="e.g., 6.1300" />
          </label>
        </div>
        <div id="gotoFieldsUTM" class="goto-fields" hidden>
          <label class="field">
            <span class="label" data-i18n="gotoModal.utmZone">UTM Zone</span>
            <input id="gotoUtmZone" type="text" maxlength="4" placeholder="32U" />
          </label>
          <label class="field">
            <span class="label" data-i18n="gotoModal.utmEasting">Easting (mE)</span>
            <input id="gotoUtmEasting" type="number" step="1" placeholder="445000" />
          </label>
          <label class="field">
            <span class="label" data-i18n="gotoModal.utmNorthing">Northing (mN)</span>
            <input id="gotoUtmNorthing" type="number" step="1" placeholder="5412000" />
          </label>
        </div>
        <div id="gotoFieldsGK" class="goto-fields" hidden>
          <label class="field">
            <span class="label" data-i18n="gotoModal.gkZone">GK Zone</span>
            <input id="gotoGkZone" type="number" min="0" max="60" step="1" placeholder="2" />
          </label>
          <label class="field">
            <span class="label" data-i18n="gotoModal.gkEasting">Easting (m)</span>
            <input id="gotoGkEasting" type="number" step="1" placeholder="3450000" />
          </label>
          <label class="field">
            <span class="label" data-i18n="gotoModal.gkNorthing">Northing (m)</span>
            <input id="gotoGkNorthing" type="number" step="1" placeholder="5483000" />
          </label>
        </div>
        <div class="switch-field">
          <span id="gotoAddPoiLabel" class="label">Add POI at this location</span>
          <label class="switch">
            <input id="gotoAddPoi" type="checkbox" role="switch" aria-labelledby="gotoAddPoiLabel" aria-checked="false" />
            <span class="switch-track"><span class="switch-handle"></span></span>
          </label>
        </div>
        <label id="gotoPoiNameField" class="field" hidden>
          <span class="label">POI name</span>
          <input id="gotoPoiName" type="text" placeholder="Optional name" />
        </label>
        <div class="modal-row">
          <div class="spacer"></div>
          <button id="gotoSubmit" class="btn btn-primary">Go</button>
        </div>
      </div>
    </div>
  </div>

  <div id="exportLoadingModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="exportLoadingTitle" hidden>
    <div class="modal-backdrop"></div>
    <div class="modal-panel export-loading-panel">
      <div class="modal-header">
        <h3 id="exportLoadingTitle" data-i18n="export.loadingTitle">Preparing export</h3>
      </div>
      <div class="modal-body export-loading-body">
        <div class="loading-spinner loading-spinner--lg" aria-hidden="true"></div>
        <div id="exportLoadingText" class="modal-text muted" data-i18n="export.loadingSnapshot">Preparing snapshot export...</div>
      </div>
    </div>
  </div>

  <!-- Add Team Member Modal -->
  <div id="teamMemberModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamMemberTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(980px, 96vw);">
      <div class="modal-header">
        <h3 id="teamMemberTitle" data-i18n="teams.memberModal.title">Add team member</h3>
        <button id="teamMemberClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body team-member-body">
        <div class="team-member-content">
          <div class="team-member-preview">
            <div id="teamMemberQrLoading" class="team-member-qr-loading" aria-hidden="true" hidden>
              <div class="loading-spinner loading-spinner--lg" aria-hidden="true"></div>
            </div>
            <img id="teamMemberQr" src="" alt="Team member QR code" />
          </div>
          <div class="team-member-explainer">
            <h4 class="team-member-heading" data-i18n="teams.memberModal.qrHeading">Scan the QR-Code using the Tracker (CYNOOPS) mobile app</h4>
            <p class="team-member-copy" data-i18n="teams.memberModal.qrCopy">The Tracker app allows to see team members on the map in real-time* and see where they are.</p>
            <div id="teamMemberStatus" class="muted team-member-status" data-i18n="teams.memberModal.subtitle">Scan this QR code to join the team.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Trim Member Session Modal -->
  <div id="trimMemberModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trimMemberTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(980px, 96vw);">
      <div class="modal-header">
        <h3 id="trimMemberTitle">Trim member session</h3>
        <button id="trimMemberClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body trim-member-body">
        <div class="trim-member-map-wrap">
          <div id="trimMemberMap" class="trim-member-map" aria-label="Trim member map"></div>
          <div id="trimMemberMapEmpty" class="trim-member-empty" hidden>No location data yet.</div>
        </div>
        <div id="trimMemberSlider" class="trim-member-slider" aria-label="Trim range">
          <div class="trim-range-meta">
            <div class="trim-range-meta-block trim-range-meta-start">
              <span class="trim-range-meta-title">Start</span>
              <span id="trimMemberRangeStartLabel" class="trim-range-meta-value">—</span>
              <span id="trimMemberRangeStartDate" class="trim-range-meta-sub">—</span>
            </div>
            <div class="trim-range-meta-block trim-range-meta-length">
              <span class="trim-range-meta-title">Length</span>
              <span id="trimMemberRangeLength" class="trim-range-meta-value">—</span>
              <span id="trimMemberRangePoints" class="trim-range-meta-sub">—</span>
            </div>
            <div class="trim-range-meta-block trim-range-meta-end">
              <span class="trim-range-meta-title">End</span>
              <span id="trimMemberRangeEndLabel" class="trim-range-meta-value">—</span>
              <span id="trimMemberRangeEndDate" class="trim-range-meta-sub">—</span>
            </div>
          </div>
          <div class="trim-range-control">
            <div class="trim-range-track">
              <div id="trimMemberRangeFill" class="trim-range-fill"></div>
            </div>
            <input id="trimMemberRangeStart" class="trim-range-input trim-range-start" type="range" min="0" max="1" value="0" step="1" aria-label="Trim start" />
            <input id="trimMemberRangeEnd" class="trim-range-input trim-range-end" type="range" min="0" max="1" value="1" step="1" aria-label="Trim end" />
          </div>
        </div>
        <div class="modal-row trim-member-footer">
          <div id="trimMemberStatus" class="trim-member-status muted">Showing full track</div>
          <div class="spacer"></div>
          <button id="trimMemberExtract" class="btn btn-primary" type="button" hidden>Extract to Feature</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Team Session Modal -->
  <div id="teamsStartSessionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamsStartSessionTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(520px, 92vw);">
      <div class="modal-header">
        <h3 id="teamsStartSessionTitle" data-i18n="teams.startSessionModal.title">Start Session</h3>
        <button id="teamsStartSessionClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <form id="teamsStartSessionForm" class="modal-body">
        <label class="field">
          <span class="label" data-i18n="teams.startSessionModal.label">Session title</span>
          <input id="teamsStartSessionTitleInput" type="text" autocomplete="off" data-i18n-placeholder="teams.startSessionModal.placeholder" placeholder="e.g., Mountain Rescue A" />
          <div class="field-note muted" data-i18n="teams.startSessionModal.note">A date prefix (YYYYMMDD - ) is added automatically.</div>
        </label>
        <div class="modal-row">
          <div class="spacer"></div>
          <button id="teamsStartSessionCancel" class="btn" type="button" data-i18n="teams.startSessionModal.cancel">Cancel</button>
          <button id="teamsStartSessionSubmit" class="btn btn-primary" type="submit" data-i18n="teams.startSessionModal.submit">Create Session</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Load Team Session Modal -->
  <div id="teamsResumeSessionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamsResumeSessionTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(720px, 94vw);">
      <div class="modal-header">
        <h3 id="teamsResumeSessionTitle" data-i18n="teams.loadSessionModal.title">Load Session</h3>
        <button id="teamsResumeSessionClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body">
        <div id="teamsLoadSessionStatus" class="muted" role="status" aria-live="polite" data-i18n="teams.loadSessionModal.loading">Loading sessions...</div>
        <div id="teamsLoadSessionList" class="session-list" role="list" aria-live="polite"></div>
        <div class="modal-row">
          <div class="spacer"></div>
          <div id="teamsResumeSessionInlineStart" class="modal-inline-start" hidden>
            <span class="muted" data-i18n="teams.loadSessionModal.or">or</span>
            <button id="teamsResumeSessionStart" class="btn btn-primary" type="button" data-i18n="teams.loadSessionModal.startInline">Start a new session</button>
          </div>
          <button id="teamsResumeSessionCancel" class="btn" type="button" data-i18n="common.close">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Actions Modal -->
  <div id="teamsSessionActionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamsSessionActionsTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(520px, 92vw);">
      <div class="modal-header">
        <h3 id="teamsSessionActionsTitle" data-i18n="teams.sessionActionsModal.title">Session actions</h3>
        <button id="teamsSessionActionsClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body session-actions-body">
        <div class="session-actions-meta">
          <div class="session-actions-id">
            <span class="session-actions-id-label" data-i18n="teams.sessionActionsModal.sessionIdLabel">Session ID</span>
            <span id="teamsSessionActionsId" class="session-actions-id-value">—</span>
          </div>
        </div>
        <form id="teamsSessionRenameForm" class="session-actions-group session-actions-group--rename">
          <div class="session-actions-rename-row">
            <label class="field">
              <span class="label" data-i18n="teams.sessionActionsModal.renameLabel">Session name</span>
              <input id="teamsSessionRenameInput" type="text" autocomplete="off" data-i18n-placeholder="teams.sessionActionsModal.renamePlaceholder" placeholder="e.g., Operation Alpha" />
            </label>
            <button id="teamsSessionRenameSubmit" class="btn btn-primary" type="submit" data-i18n="features.menu.save">Save</button>
          </div>
        </form>
        <div class="session-actions-group session-actions-group--stop">
          <div class="session-actions-copy">
            <p class="modal-text" data-i18n="teams.sessionActionsModal.stopHint">Stop this session by adding an end date.</p>
          </div>
          <div class="session-actions-cta">
            <button id="teamsSessionStopAction" class="btn btn-danger" type="button" data-i18n="teams.sessionActionsModal.stopButton">Stop session</button>
          </div>
        </div>
        <div class="session-actions-group session-actions-group--close">
          <div class="session-actions-copy">
            <p class="modal-text" data-i18n="teams.sessionActionsModal.closeHint">Close the session and reset the map, features, and teams. GPX stays.</p>
          </div>
          <div class="session-actions-cta">
            <button id="teamsSessionCloseAction" class="btn" type="button" data-i18n="teams.sessionActionsModal.closeButton">Close session</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Team Session Modal -->
  <div id="teamsDeleteSessionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamsDeleteSessionTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(420px, 90vw);">
      <div class="modal-header">
        <h3 id="teamsDeleteSessionTitle" data-i18n="teams.deleteSessionModal.title">Delete session?</h3>
        <button id="teamsDeleteSessionClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body">
        <p id="teamsDeleteSessionMessage" class="modal-text" data-i18n="teams.deleteSessionModal.message">Are you sure you want to delete this session and all its data?</p>
        <p id="teamsDeleteSessionWarning" class="modal-text modal-text-danger" data-i18n="teams.deleteSessionModal.warning">Danger: this cannot be undone.</p>
        <div id="teamsDeleteSessionMeta" class="modal-text muted" aria-live="polite"></div>
        <div id="teamsDeleteSessionStatus" class="muted" role="status" aria-live="polite" hidden></div>
        <div class="modal-row">
          <div class="spacer"></div>
          <button id="teamsDeleteSessionCancel" class="btn" type="button" data-i18n="teams.deleteSessionModal.cancel">Cancel</button>
          <button id="teamsDeleteSessionConfirm" class="btn btn-danger" type="button" data-i18n="teams.deleteSessionModal.confirm">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Clear All Sessions Modal -->
  <div id="firebaseAdminClearSessionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="firebaseAdminClearSessionsTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(520px, 92vw);">
      <div class="modal-header">
        <h3 id="firebaseAdminClearSessionsTitle" data-i18n="settings.firebaseAdminClearSessionsModal.title">Clear all sessions?</h3>
        <button id="firebaseAdminClearSessionsClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="settings.firebaseAdminClearSessionsModal.message">This will permanently delete every session document and its tracker/update data in Firestore.</p>
        <p class="modal-text modal-text-danger" data-i18n="settings.firebaseAdminClearSessionsModal.warning">Danger: this cannot be undone.</p>
        <div id="firebaseAdminClearSessionsStatus" class="muted" role="status" aria-live="polite" hidden></div>
        <div class="modal-row">
          <div class="spacer"></div>
          <button id="firebaseAdminClearSessionsCancel" class="btn" type="button" data-i18n="settings.firebaseAdminClearSessionsModal.cancel">Cancel</button>
          <button id="firebaseAdminClearSessionsConfirm" class="btn btn-danger" type="button" data-i18n="settings.firebaseAdminClearSessionsModal.confirm">Clear all sessions</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Clear Anonymous Users Modal -->
  <div id="firebaseAdminClearAnonymousUsersModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="firebaseAdminClearAnonymousUsersTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(520px, 92vw);">
      <div class="modal-header">
        <h3 id="firebaseAdminClearAnonymousUsersTitle" data-i18n="settings.firebaseAdminClearAnonymousUsersModal.title">Clear anonymous users?</h3>
        <button id="firebaseAdminClearAnonymousUsersClose" class="btn-icon" title="Close" data-i18n-title="common.close">×</button>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="settings.firebaseAdminClearAnonymousUsersModal.message">This will permanently delete all anonymous users in Firebase Authentication.</p>
        <p class="modal-text modal-text-danger" data-i18n="settings.firebaseAdminClearAnonymousUsersModal.warning">Danger: this cannot be undone.</p>
        <div id="firebaseAdminClearAnonymousUsersStatus" class="muted" role="status" aria-live="polite" hidden></div>
        <div class="modal-row">
          <div class="spacer"></div>
          <button id="firebaseAdminClearAnonymousUsersCancel" class="btn" type="button" data-i18n="settings.firebaseAdminClearAnonymousUsersModal.cancel">Cancel</button>
          <button id="firebaseAdminClearAnonymousUsersConfirm" class="btn btn-danger" type="button" data-i18n="settings.firebaseAdminClearAnonymousUsersModal.confirm">Clear anonymous users</button>
        </div>
      </div>
    </div>
  </div>
  <div id="firebaseDeployModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="firebaseDeployTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" style="width:min(720px, 94vw);">
      <div class="modal-header">
        <h3 id="firebaseDeployTitle" data-i18n="settings.firebaseDeployingTitle">Deploying Firebase…</h3>
        <button id="firebaseDeployModalClose" class="btn btn-icon" type="button" aria-label="Close" data-action="close">✕</button>
      </div>
      <div class="modal-body firebase-deploy-body">
        <div id="firebaseDeployStatus" class="modal-text muted" data-i18n="settings.firebaseDeployingHint">Deployment in progress. Logs below.</div>
        <pre id="firebaseDeployLog" class="firebase-deploy-log" aria-live="polite"></pre>
        <div class="modal-row">
          <button id="firebaseDeployModalDone" class="btn btn-primary" type="button" data-i18n="settings.firebaseDeployingClose" disabled>Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div id="shortcutsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="shortcutsTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="shortcutsTitle">Keyboard Shortcuts</h3>
        <button id="shortcutsClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="shortcutsList" class="shortcut-grid" role="list"></div>
      </div>
    </div>
  </div>

  <!-- Color Picker Modal -->
  <div id="colorModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="colorTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="colorTitle">Pick Color</h3>
        <button id="colorClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="colorGrid" class="color-grid" role="grid" aria-label="Colors"></div>
      </div>
    </div>
  </div>

  <!-- POI Icon Modal -->
  <div id="poiIconModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="poiIconTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="poiIconTitle">POI Symbol</h3>
        <button id="poiIconClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="poiIconStatus" class="muted" role="status" aria-live="polite"></div>
        <div id="poiIconGrid" class="poi-icon-grid" role="grid" aria-label="POI symbols"></div>
      </div>
    </div>
  </div>

  <!-- AI Modal -->
  <div id="aiModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="aiTitle" hidden>
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3 id="aiTitle">AI Assistant</h3>
        <button id="aiClose" class="btn-icon" title="Close">×</button>
      </div>
      <div class="modal-body">
        <div id="aiMeta" class="ai-meta"></div>
        <label class="field">
          <span class="label">Suggested modification</span>
          <select id="aiPreset"></select>
        </label>
        <label class="field" id="aiValueField" hidden>
          <span class="label">Value</span>
          <input id="aiValueInput" type="number" step="0.01" />
        </label>
        <label class="field" id="aiDirectionField" hidden>
          <span class="label">Direction</span>
          <select id="aiDirectionSelect">
            <option value="north">North</option>
            <option value="east">East</option>
            <option value="south">South</option>
            <option value="west">West</option>
          </select>
        </label>
        <label class="field">
          <span class="label">Instruction</span>
          <textarea id="aiInput" rows="4" placeholder="Add custom instructions for the AI (optional)"></textarea>
        </label>
        <label class="field">
          <span class="label">Additional modifiers (optional)</span>
          <textarea id="aiModifiers" rows="3" placeholder="Add any extra constraints or details you'd like the AI to consider."></textarea>
        </label>
        <label class="field field-inline">
          <input id="aiReplaceOriginal" type="checkbox" />
          <span>Replace original geometry</span>
        </label>
        <div class="modal-row">
          <div id="aiSpinner" aria-hidden="true"></div>
          <div class="spacer"></div>
          <button id="aiSubmit" class="btn btn-primary">SUBMIT</button>
        </div>
        <div id="aiError" class="muted" role="alert" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Mapbox GL JS (CSP build) -->
  <script src="./dist/vendor/mapbox-gl/mapbox-gl-csp.js"></script>
  <script src="./dist/vendor/qrcode-generator.js"></script>
  <script src="./dist/vendor/firebase/firebase-app-compat.js"></script>
  <script src="./dist/vendor/firebase/firebase-firestore-compat.js"></script>
  <!-- Your renderer bundle goes here -->
  <script src="./renderer.js"></script>
</body>
</html>
